<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘ä»¬çš„æ—¶å…‰åšç‰©é¦† | äº‘ç«¯åŒæ­¥ç‰ˆ</title>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root { --accent: #ff7e5f; --bg: #0f1012; --glass: rgba(255, 255, 255, 0.08); }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding-bottom: 100px; }
        
        /* 1. å€’è®¡æ—¶æŒ‚ä»¶ï¼šç½®é¡¶é†’ç›® */
        .countdown-timer {
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            padding: 12px; text-align: center; font-size: 14px; font-weight: bold;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* 2. å¯¼èˆªæ  */
        header { padding: 30px 10px; text-align: center; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
        .avatar-bar { display: flex; justify-content: center; gap: 15px; overflow-x: auto; padding: 10px; }
        .person-btn { cursor: pointer; text-align: center; min-width: 65px; opacity: 0.6; transition: 0.3s; }
        .person-btn.active { opacity: 1; transform: scale(1.1); }
        .img-box { width: 55px; height: 55px; border-radius: 50%; border: 2px solid transparent; overflow: hidden; margin: 0 auto 5px; background: #333; }
        .person-btn.active .img-box { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .person-btn span { font-size: 12px; display: block; margin-top: 5px; }

        /* 3. ç…§ç‰‡å¢™ */
        .container { padding: 20px; columns: 2; column-gap: 20px; max-width: 1000px; margin: 0 auto; }
        @media (min-width: 768px) { .container { columns: 3; } }
        
        .card { break-inside: avoid; margin-bottom: 20px; background: var(--glass); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card img, .card video { width: 100%; display: block; }
        
        /* 4. ç‚¹èµäº’åŠ¨åŒº */
        .card-footer { padding: 12px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
        .like-btn { cursor: pointer; display: flex; align-items: center; gap: 5px; color: #ff7e5f; font-size: 14px; transition: 0.2s; }
        .like-btn:active { transform: scale(1.3); }
        .time-label { font-size: 10px; color: #777; }

        /* 5. æ‚¬æµ®æŒ‰é’® */
        .add-btn { position: fixed; bottom: 30px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); color: white; font-size: 35px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 25px rgba(255,126,95,0.4); z-index: 1001; }
    </style>
</head>
<body>

<div class="countdown-timer" id="days-count">æ­£åœ¨è®¡ç®—å›¢åœ†å€’è®¡æ—¶...</div>

<header>
    <div class="avatar-bar">
        <div class="person-btn active" onclick="filter('all', this)">
            <div class="img-box" style="line-height:55px; font-size:20px;">All</div>
            <span>å…¨éƒ¨</span>
        </div>
        
        <div class="person-btn" onclick="filter('me', this)">
            <div class="img-box"><img src="me.jpg"></div>
            <span>æˆ‘</span>
        </div>
        <div class="person-btn" onclick="filter('dad', this)">
            <div class="img-box"><img src="baba.jpg"></div>
            <span>çˆ¸çˆ¸</span>
        </div>
        <div class="person-btn" onclick="filter('mom', this)">
            <div class="img-box"><img src="mama.jpg"></div>
            <span>å¦ˆå¦ˆ</span>
        </div>
        <div class="person-btn" onclick="filter('grandma', this)">
            <div class="img-box"><img src="nainai.jpg"></div>
            <span>å¥¶å¥¶</span>
        </div>
        <div class="person-btn" onclick="filter('bro', this)">
            <div class="img-box"><img src="didi.jpg"></div>
            <span>å¼Ÿå¼Ÿ</span>
        </div>
    </div>
</header>
<div class="container" id="gallery"></div>

<div class="add-btn" id="upload-trigger">+</div>
<input type="file" id="u-file" hidden accept="image/*,video/*">

<script>
    // --- 1. åˆå§‹åŒ–äº‘ç«¯ ---
    AV.init({
        appId: "7xAbBJogqhA92wpkvvx6xitH-gzGzoHsz",
        appKey: "iFYSQEQ0pYLc9vj3JUc50iKM",
        serverURL: "https://7xabbjog.lc-cn-n1-shared.com"
    });

    let currentRole = 'all';

    // --- 2. å€’è®¡æ—¶åŠŸèƒ½ (2026å¹´æ˜¥èŠ‚) ---
    function setTimer() {
        const target = new Date("2026/02/17 00:00:00").getTime();
        const now = new Date().getTime();
        const diff = target - now;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        document.getElementById('days-count').innerText = `ğŸ® è·ç¦» 2026 æ˜¥èŠ‚å›¢åœ†è¿˜æœ‰ ${days} å¤©`;
    }
    setTimer();

    // --- 3. ä¸Šä¼ åŠŸèƒ½ (è‡ªåŠ¨å­˜å…¥äº‘ç«¯) ---
    document.getElementById('upload-trigger').onclick = () => document.getElementById('u-file').click();
    document.getElementById('u-file').onchange = async function() {
        if(!this.files.length) return;
        const file = this.files[0];
        const trigger = document.getElementById('upload-trigger');
        trigger.innerText = "â³";

        try {
            const avFile = new AV.File(file.name, file);
            await avFile.save();

            const Memory = AV.Object.extend('Memory');
            const m = new Memory();
            m.set('media', avFile);
            m.set('type', file.type.includes('video') ? 'v' : 'i');
            m.set('role', currentRole === 'all' ? 'me' : currentRole);
            m.set('likes', 0);
            await m.save();
            render();
        } catch(e) { console.error(e); alert("ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¡®ä¿LeanCloudå·²åˆ›å»ºMemoryè¡¨"); }
        trigger.innerText = "+";
    };

    // --- 4. ç‚¹èµåŠŸèƒ½ (äº‘ç«¯åŒæ­¥) ---
    async function like(id) {
        const m = AV.Object.createWithoutData('Memory', id);
        m.increment('likes', 1);
        await m.save();
        render(); // åˆ·æ–°æ•°æ®
    }

    // --- 5. æ¸²æŸ“åŠŸèƒ½ ---
    async function render() {
        const query = new AV.Query('Memory');
        query.descending('createdAt');
        if(currentRole !== 'all') query.equalTo('role', currentRole);
        
        const results = await query.find();
        const g = document.getElementById('gallery');
        g.innerHTML = results.map(item => {
            const d = item.attributes;
            const url = d.media.attributes.url;
            return `
                <div class="card">
                    ${d.type === 'v' ? `<video src="${url}" controls></video>` : `<img src="${url}">`}
                    <div class="card-footer">
                        <span class="time-label">${item.createdAt.toLocaleDateString()}</span>
                        <div class="like-btn" onclick="like('${item.id}')">â¤ï¸ <span>${d.likes || 0}</span></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function filter(role, el) {
        currentRole = role;
        document.querySelectorAll('.person-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        render();
    }

    render();
</script>
</body>
</html>